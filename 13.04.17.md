# Ссылочные типы и типы по значению.
##### Лекция 13.04.17.

В C# все типы делятся на две категории:

1) Ссылочные типы
2) Типы по значению (структурные типы)

__Стек__ – область памяти, которая используется для передачи параметров в методы, а также для хранения определенных методов локальных переменных.

## Типы по значению

Типы по значению хранятся в стеке. Данные типы по значению хранятся в самой переменной. К типам по значению относятся:

1) Целочисленные типы: `int`, `byte`
2) Типы с плавающей точкой: `float`, `double`
3) Булевый тип: `bool`
4) Десятичный тип: `decimal`
5) Перечисление: `enum`
6) Структура: `struct`

```csharp
static void Main(string[] arg)
{
	int a = 1;
	int b = 3;

	b = a;
	a = 3;
  
	Console.WriteLine(a); // 3
  	Console.WriteLine(b); // 1
}
```

В данном примере происходит присваивание значения одной переменной - другой. Дальнейшее изменение значения одной из переменных не влияет на изменение значения другой переменной. Это происходит потому что значение хранится в самой переменной.

## Переменные ссылочного типа

__Куча__ - это область памяти, в которой размещаются направляющие объекты, а также сборщик мусора.

__Сборщик мусора__ - механизм, который удаляет ненужные переменные и объекты.

Переменные ссылочного типа содержат не сами данные, а ссылку на них. Сами же данные хранятся в куче.

К ссылочным типам относятся:

1) Классы `class`
2) Интерфейсы `interface`
3) Делегаты `delegate`
4) Тип `object`
5) Тип `string`

```csharp
class Test
{
	public int x;
}

class Program
{
	static void Main(string[] arg)
    {
    	Test a = new Test();
        Test b = new Test();
        
        a.x = 1;
        b.x = 2;
        
        b = a;  // (1)
        b.x = 3;
        
        Console.WriteLine(a.x); // 3
        Console.WriteLine(b.x); // 3
    }
}
```

После выполнения строки __(1)__ и переменная `a`, и переменная `b` имеет одну ссылку на объект. После изменения свойства `x` объекта `b`, изменяется свойство `x` объекта `a`.

## Передача параметров по ссылке

В С# все переменные по умолчанию передаются, как тип по значению (создается локальная копия параметра, который мы передаем). Это означает, что мы не можем изменить значение параметра, которое находится вне метода.

```csharp
public static void C(int a)
{
	a = 2;
}

public void Main(string[] arg)
{
	int a = 1;
    C(a);
    Console.WriteLine(a); // 1
}
```

### Ключевое слово `ref`

Чтобы передать параметр по ссылке используется ключевые слова `ref` и `out`. Для того чтобы использовать `ref`, его следует указать перед входным параметром метода и перед параметром при вызове:

```csharp
public static void C(ref int a)
{
	a = 2;
}

public void Main(string[] arg)
{
	int a = 1;
    C(ref a);
    Console.WriteLine(a); // 2
}
```

В случае использования `ref` требуется инициализация переменной до ее передачи в метод.

### Ключевое слово `out`

Если используется `out`, то переменную инициализировать не обязательно, но в теле функции обязательно нужно инициализировать переменную, иначе компилятор выдаст ошибку:

```csharp
public static void C(out int a)
{
	a = 2;
}

public void Main(string[] arg)
{
	int a;
    C(out a);
    Console.WriteLine(a); // 2
}
```

# Сетевое программирование в C#
##### Лекция 19.04.17

__Информационная сеть__ - набор узлов (ПК, сервера, т.д.), телекоммуникационного оборудования (коммутаторы, маршрутизаторы), а также линии связи.

Обычно информационная сеть строится по архитектуре клиент-сервер. Клиент инициирует запросы, сервер обрабатывает их и возвращает результат. И клиент, и сервер могут быть как аппаратными, так и программными.

Клиент и сервер взаимодействуют между собой при помощи протоколов. __Протокол__ - набор правил и методов, при помощи которых передаются данные по сети. Передача данных по сети является сложной задачей и для ее решения используется принцип декомпозции (сложная задача разбивается на подзадачи, решаемые отдельно).

Модель взаимодействия открытых систем `ISO / OSI`. Модель предполагает, что протоколы разбиваютс на 7 уровней:

![Сетевая модель OSI](http://www.doctorrouter.ru/wp-content/uploads/2014/04/86ea4e.png)

В платформе .NET для работы с сетью используется пространство имен `System.Net`. Это пространство имен предоставляет классы для работы со многими протоколами:

- классы, описывающие запрос и ответ - `WebRequest`, `WebResponse`
- классы клиента `WebClient`
- классы IP адреса
- и так далее

## Протокол `HTTP` в  С#

![Модель клиент-сервер](https://ci.inria.fr/pharo-contribution/job/EnterprisePharoBook/lastSuccessfulBuild/artifact/book-result/Zinc-HTTP-Client/figures/clientServer.png)

Например,

- __Client__: Chrome, программа C#, ...
- __Server__: Apache, Nginx, PHP, Perl, Go, NodeJS, Python, Ruby, C/C++, C#, Java, ...

Запрос состоит из заголовка и тела запроса.

### Работа в C#

Классы:

- `System.Net.HttpWebRequest`
- `System.Net.HttpWebResponse`

Пример:

```csharp
using System;
using System.Net;

namespace NP
{
	class Program
    {
    	static void Main(string[] args)
        {
            string uri = 'www.misis.ru';

            HttpWebRequest request = (HttpWebRequest) WebRequest.Create(uri);
            HttpWebResponse response = (HttpWebResponse) request.GetResponse();


            StreamReader reader = new StreamReader(response.GetResponseStream(), Encoding.UTF8);

            Console.WriteLine(reader.ReadToEnd());
        }
    }
}
```
